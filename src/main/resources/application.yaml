server:
  port: ${PORT:8086} # Cloud Run uses PORT environment variable

spring:
  application:
    name: user-service

  # ---------- DATABASE ----------
  datasource:
    url: ${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5432/user_service_db}
    username: ${SPRING_DATASOURCE_USERNAME:postgres}
    password: ${SPRING_DATASOURCE_PASSWORD:}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: ${SPRING_DATASOURCE_MAX_POOL:10}
      maxLifetime: 30000        # Prevent stale connections
      idleTimeout: 10000
      minimumIdle: 1

  # ---------- JPA ----------
  jpa:
    hibernate:
      ddl-auto: ${SPRING_JPA_HIBERNATE_DDL_AUTO:update}
    show-sql: ${SPRING_JPA_SHOW_SQL:true}
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.PostgreSQLDialect
    open-in-view: false

  # ---------- REDIS ----------
  redis:
    host: ${SPRING_REDIS_HOST:localhost}
    port: ${SPRING_REDIS_PORT:6379}
    password: ${SPRING_REDIS_PASSWORD:}
    ssl: ${SPRING_REDIS_SSL:false}

management:
  endpoints:
    web:
      exposure:
        include: health, info
  endpoint:
    health:
      show-details: always

# ---------- EUREKA ----------
eureka:
  client:
    fetch-registry: true
    register-with-eureka: true
    service-url:
      defaultZone: ${EUREKA_URL:https://eureka-server-142422750329.asia-southeast1.run.app/eureka/}
  instance:
    prefer-ip-address: false
    hostname: ${CLOUD_RUN_URL}
    instance-id: ${spring.application.name}:${random.value}
    non-secure-port-enabled: false
    secure-port-enabled: true
    status-page-url: ${CLOUD_RUN_URL}/actuator/health
    health-check-url: ${CLOUD_RUN_URL}/actuator/health
    metadata-map:
      management.port: ${server.port}

# ---------- APP INFO ----------
info:
  app:
    name: ${spring.application.name}
    description: User Service for Supreme Solutions
    version: 1.0.0
    author: Manav Kapur
